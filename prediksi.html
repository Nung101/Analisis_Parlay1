<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Prediksi Multi Pertandingan</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background:#f4f4f4; }
    .match { margin:15px 0; padding:10px; border:1px solid #aaa; border-radius:6px; background:#fff; }
    input { width: 80px; margin: 5px; }
    button { padding: 8px 12px; margin: 10px 5px; cursor:pointer; }
    .hasil { margin-top: 10px; padding: 10px; border: 1px solid #ccc; background:#fafafa; border-radius:6px; }
    table { border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 4px 8px; text-align: center; }
    th { background:#eee; }
  </style>
</head>
<body>
  <h2>üìä Prediksi Multi Pertandingan</h2>
  <div id="matches"></div>

  <button onclick="tambahMatch()">Tambah Pertandingan</button>
  <button onclick="hitungSemua()">Hitung Semua</button>
  <button onclick="resetSemua()">Reset Semua</button>

<script>
let matchCount = 0;

function tambahMatch() {
  matchCount++;
  let div = document.createElement("div");
  div.className = "match";
  div.id = "match"+matchCount;
  div.innerHTML = `
    <h3>Pertandingan ${matchCount}</h3>
    Tim A (Home) - xG: <input type="number" step="0.01" id="xgA${matchCount}">
    xGA: <input type="number" step="0.01" id="xgaA${matchCount}"><br>
    Tim B (Away) - xG: <input type="number" step="0.01" id="xgB${matchCount}">
    xGA: <input type="number" step="0.01" id="xgaB${matchCount}"><br>
    <div class="hasil" id="output${matchCount}"></div>
  `;
  document.getElementById("matches").appendChild(div);
}

function logistic(x) { return 1 / (1 + Math.exp(-x)); }
function poisson(lambda, k) { return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k); }
function factorial(n) { return n <= 1 ? 1 : n * factorial(n - 1); }

function hitungSemua() {
  for (let i=1; i<=matchCount; i++) {
    hitungMatch(i);
  }
}

function hitungMatch(id) {
  let xgA = parseFloat(document.getElementById("xgA"+id).value) || 0;
  let xgaA = parseFloat(document.getElementById("xgaA"+id).value) || 0;
  let xgB = parseFloat(document.getElementById("xgB"+id).value) || 0;
  let xgaB = parseFloat(document.getElementById("xgaB"+id).value) || 0;

  let lambdaA = (xgA + xgaB) / 2;
  let lambdaB = (xgB + xgaA) / 2;
  let totalGol = (xgA + xgaA + xgB + xgaB) / 2;

  // Over/Under
  let lines = [2.0, 2.25, 2.5, 2.75, 3.0];
  let ouTable = "";
  let ouData = {};
  lines.forEach(line => {
    let diff = totalGol - line;
    let probOver = logistic(diff * 2) * 100;
    let probUnder = 100 - probOver;
    ouData[line] = {over: probOver, under: probUnder};
    ouTable += `<tr><td>${line}</td><td>${probOver.toFixed(1)}%</td><td>${probUnder.toFixed(1)}%</td></tr>`;
  });
  let over25 = ouData[2.5].over;
  let under25 = ouData[2.5].under;
  let rekomOU = "Netral";
  if (over25 - under25 > 10) rekomOU = "Over 2.5";
  else if (under25 - over25 > 10) rekomOU = "Under 2.5";

  // HDP
  let selisih = xgA - xgB;
  let absSelisih = Math.abs(selisih);
  let hdp;
  if (absSelisih < 0.25) hdp = "0";
  else if (absSelisih < 0.5) hdp = (selisih > 0 ? "A -0.25" : "B -0.25");
  else if (absSelisih < 0.75) hdp = (selisih > 0 ? "A -0.5" : "B -0.5");
  else hdp = (selisih > 0 ? "A -0.75+" : "B -0.75+");

  // BTTS
  let probBTTS = (Math.min(1,xgA/2) * Math.min(1,xgB/2) * 100).toFixed(1);
  let bttsLabel = probBTTS > 55 ? "Yes" : (probBTTS < 45 ? "No" : "Netral");

  // Skor Poisson
  let scores = [];
  for (let i = 0; i <= 4; i++) {
    for (let j = 0; j <= 4; j++) {
      let p = poisson(lambdaA,i)*poisson(lambdaB,j);
      scores.push({score:`${i}-${j}`, prob:p});
    }
  }
  scores.sort((a,b)=>b.prob-a.prob);
  let topScores = scores.slice(0,3).map(s=>`${s.score} (${(s.prob*100).toFixed(1)}%)`).join("<br>");

  // 1X2
  let winA=0, draw=0, winB=0;
  scores.forEach(s=>{
    let [a,b]=s.score.split("-").map(Number);
    if (a>b) winA+=s.prob;
    else if (a==b) draw+=s.prob;
    else winB+=s.prob;
  });
  winA*=100; draw*=100; winB*=100;

  document.getElementById("output"+id).innerHTML = `
    <b>‚öΩ Estimasi Gol:</b> A ${lambdaA.toFixed(2)} - B ${lambdaB.toFixed(2)}<br>
    Total: ${totalGol.toFixed(2)}<br><br>
    <b>üìà O/U Probabilitas</b><br>
    <table><tr><th>Line</th><th>Over</th><th>Under</th></tr>${ouTable}</table>
    Rekomendasi: <b>${rekomOU}</b><br><br>
    <b>üèÜ HDP:</b> ${hdp}<br>
    <b>üéØ BTTS:</b> ${probBTTS}% ‚Üí ${bttsLabel}<br><br>
    <b>üìå Skor Poisson:</b><br>${topScores}<br><br>
    <b>üîÆ 1X2:</b><br>
    1: ${winA.toFixed(1)}% | X: ${draw.toFixed(1)}% | 2: ${winB.toFixed(1)}%<br>
  `;
}

function resetSemua() {
  document.getElementById("matches").innerHTML = "";
  matchCount = 0;
}
</script>
</body>
</html>