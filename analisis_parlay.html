<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi-Match Predictor (Monte Carlo 20k)</title>
<style>
body{font-family:sans-serif;background:#f8fafc;margin:20px;color:#0f172a}
h1{margin-bottom:10px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;text-align:center;font-size:14px}
input{width:100%;padding:4px;text-align:center;border-radius:4px;border:1px solid #aaa}
button{padding:8px 12px;margin:5px;border:none;border-radius:6px;background:#0ea5a4;color:#fff;cursor:pointer}
.badge{padding:4px 6px;border-radius:4px;background:#d1fae5;color:#065f46;font-weight:700}
</style>
</head>
<body>
<h1>Multi-Match Monte Carlo Predictor (20k Sim)</h1>
<p>Isi 1â€“20 pertandingan, lalu klik <strong>Analisis Semua</strong></p>

<table id="matchesTable">
<thead>
<tr>
<th>No</th><th>Tim A</th><th>Tim B</th><th>Avg GF-GA A</th><th>Avg GF-GA B</th><th>Line HDP</th><th>Odds HDP</th><th>Line O/U</th><th>Odds O/U</th>
</tr>
</thead>
<tbody>
<!-- contoh 5 baris, bisa ditambah -->
<tr><td>1</td><td><input></td><td><input></td><td><input placeholder="GF-GA"></td><td><input placeholder="GF-GA"></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
<tr><td>2</td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
<tr><td>3</td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
<tr><td>4</td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
<tr><td>5</td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
</tbody>
</table>

<button id="analyzeBtn">Analisis Semua</button>

<div id="results" style="margin-top:20px"></div>

<script>
// Utility
function parseGFGa(str){ 
  const m=str.match(/(\d+)\s*-\s*(\d+)/); 
  return m?{gf:+m[1],ga:+m[2]}:{gf:1,ga:1}; // default 1-1
}
function poisson(lambda){ 
  let L=Math.exp(-lambda), k=0, p=1;
  do { k++; p*=Math.random(); } while(p>L); 
  return k-1; 
}
function monteCarloMatch(xgA,xgB,sims,lineOU){
  let wA=0,wB=0,draw=0,over=0,BTTS=0;
  for(let i=0;i<sims;i++){
    const a=poisson(xgA), b=poisson(xgB);
    if(a>b) wA++; else if(a<b) wB++; else draw++;
    if(a+b>lineOU) over++;
    if(a>0 && b>0) BTTS++;
  }
  const pA=wA/sims, pB=wB/sims, pd=draw/sims, pOver=over/sims, pBTTS=BTTS/sims;
  let bestPick=''; if(pA>pB && pA>pd) bestPick='Tim A'; else if(pB>pA && pB>pd) bestPick='Tim B'; else bestPick='Draw';
  let safePick=(pOver>0.5)? 'Over '+lineOU : 'Under '+lineOU;
  safePick=bestPick+' & '+safePick;
  return {pA,pB,pd,pOver,pBTTS,bestPick,safePick};
}

document.getElementById('analyzeBtn').addEventListener('click',()=>{
  const tbody=document.querySelector('#matchesTable tbody');
  const rows=tbody.querySelectorAll('tr');
  let html='<h2>Hasil Analisis (Monte Carlo 20k)</h2><table><tr><th>No</th><th>Match</th><th>W %</th><th>D %</th><th>L %</th><th>Over %</th><th>BTTS %</th><th>Best Pick</th><th>Safe Pick</th></tr>';
  rows.forEach((row,i)=>{
    const cells=row.querySelectorAll('td input');
    const teamA=cells[0].value||'Team A', teamB=cells[1].value||'Team B';
    const avgA=parseGFGa(cells[2].value||'1-1'), avgB=parseGFGa(cells[3].value||'1-1');
    const lineHDP=parseFloat(cells[4].value)||0, oddsH=parseFloat(cells[5].value)||1.9;
    const lineOU=parseFloat(cells[6].value)||2.5, oddsOU=parseFloat(cells[7].value)||1.9;
    // xG sederhana
    const xgA=(avgA.gf+avgB.ga)/2, xgB=(avgB.gf+avgA.ga)/2;
    const res=monteCarloMatch(xgA,xgB,20000,lineOU);
    html+='<tr><td>'+(i+1)+'</td><td>'+teamA+' vs '+teamB+'</td><td>'+Math.round(res.pA*100)+'%</td><td>'+Math.round(res.pd*100)+'%</td><td>'+Math.round(res.pB*100)+'%</td><td>'+Math.round(res.pOver*100)+'%</td><td>'+Math.round(res.pBTTS*100)+'%</td><td>'+res.bestPick+'</td><td>'+res.safePick+'</td></tr>';
  });
  html+='</table>';
  document.getElementById('results').innerHTML=html;
});
</script>
</body>
</html>
