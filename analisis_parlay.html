<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Analisis Expert++ HDP & O/U</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
    .card { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); margin-bottom: 20px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input { padding: 6px; width: 100%; margin-top: 5px; }
    button { margin-top: 15px; padding: 10px 20px; background: #007BFF; color: #fff; border: none; border-radius: 8px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .result { margin-top: 20px; padding: 15px; border-radius: 8px; }
    .high { background: #d4edda; border-left: 6px solid #28a745; }
    .moderate { background: #fff3cd; border-left: 6px solid #ffc107; }
    .low { background: #f8d7da; border-left: 6px solid #dc3545; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Analisis Expert++ HDP & O/U</h2>

    <label>Tim Home</label>
    <input type="text" id="home">

    <label>Tim Away</label>
    <input type="text" id="away">

    <label>Rata2 Gol Home</label>
    <input type="number" id="home_gf" step="0.1">

    <label>Rata2 Kebobolan Home</label>
    <input type="number" id="home_ga" step="0.1">

    <label>Rata2 Gol Away</label>
    <input type="number" id="away_gf" step="0.1">

    <label>Rata2 Kebobolan Away</label>
    <input type="number" id="away_ga" step="0.1">

    <label>H2H Home GF</label>
    <input type="number" id="h2h_home_gf" step="0.1">

    <label>H2H Home GA</label>
    <input type="number" id="h2h_home_ga" step="0.1">

    <label>H2H Away GF</label>
    <input type="number" id="h2h_away_gf" step="0.1">

    <label>H2H Away GA</label>
    <input type="number" id="h2h_away_ga" step="0.1">

    <label>Line HDP</label>
    <input type="number" id="hdp_line" step="0.25">

    <label>Odds HDP Home</label>
    <input type="number" id="odds_hdp_home" step="0.01">

    <label>Odds HDP Away</label>
    <input type="number" id="odds_hdp_away" step="0.01">

    <label>Line O/U</label>
    <input type="number" id="ou_line" step="0.5">

    <label>Odds Over</label>
    <input type="number" id="odds_over" step="0.01">

    <label>Odds Under</label>
    <input type="number" id="odds_under" step="0.01">

    <button onclick="analisis()">Analisis</button>

    <div class="result" id="output"></div>
  </div>

  <script>
    function poisson(lambda, k) {
      return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k);
    }

    function factorial(n) {
      return n <= 1 ? 1 : n * factorial(n - 1);
    }

    function tier(conf) {
      if (conf >= 75) return {label:"High Value Bet", css:"high"};
      if (conf >= 65) return {label:"Moderate Value", css:"moderate"};
      return {label:"Low Value/No Bet", css:"low"};
    }

    function analisis() {
      let home = document.getElementById('home').value;
      let away = document.getElementById('away').value;

      let home_gf = parseFloat(document.getElementById('home_gf').value);
      let home_ga = parseFloat(document.getElementById('home_ga').value);
      let away_gf = parseFloat(document.getElementById('away_gf').value);
      let away_ga = parseFloat(document.getElementById('away_ga').value);

      let h2h_home_gf = parseFloat(document.getElementById('h2h_home_gf').value);
      let h2h_home_ga = parseFloat(document.getElementById('h2h_home_ga').value);
      let h2h_away_gf = parseFloat(document.getElementById('h2h_away_gf').value);
      let h2h_away_ga = parseFloat(document.getElementById('h2h_away_ga').value);

      let hdp_line = parseFloat(document.getElementById('hdp_line').value);
      let odds_hdp_home = parseFloat(document.getElementById('odds_hdp_home').value);
      let odds_hdp_away = parseFloat(document.getElementById('odds_hdp_away').value);

      let ou_line = parseFloat(document.getElementById('ou_line').value);
      let odds_over = parseFloat(document.getElementById('odds_over').value);
      let odds_under = parseFloat(document.getElementById('odds_under').value);

      let output = `<h3>${home} vs ${away}</h3>`;

      // Weighted Attack & Defense
      let homeAttack = (home_gf * 0.65 + h2h_home_gf * 0.35);
      let homeDefense = (home_ga * 0.65 + h2h_home_ga * 0.35);
      let awayAttack = (away_gf * 0.65 + h2h_away_gf * 0.35);
      let awayDefense = (away_ga * 0.65 + h2h_away_ga * 0.35);

      // Expected Goals
      let expHome = (homeAttack + awayDefense) / 2;
      let expAway = (awayAttack + homeDefense) / 2;
      let totalGoals = expHome + expAway;

      // ADI (Attack vs Defense Index)
      let ADI_home = home_gf / (away_ga || 1);
      let ADI_away = away_gf / (home_ga || 1);

      // Strength Balance Index
      let SBI = (homeAttack - awayDefense) - (awayAttack - homeDefense);
      let GPI = (homeAttack + awayAttack) - (homeDefense + awayDefense);
      let avgH2HGoals = (h2h_home_gf + h2h_away_gf) / 2;

      // HDP Prediction
      let rekom_hdp = "No Bet";
      let hdp_conf = 55;
      if (SBI > 0.5 && odds_hdp_home < 2.05) {
        rekom_hdp = `${home} ${hdp_line}`;
        hdp_conf = 72 + (SBI * 5);
      } else if (SBI < -0.5 && odds_hdp_away < 2.05) {
        rekom_hdp = `${away} +${Math.abs(hdp_line)}`;
        hdp_conf = 72 + (Math.abs(SBI) * 5);
      }

      // O/U Prediction
      let rekom_ou = "No Bet";
      let ou_conf = 55;
      if (totalGoals > ou_line && avgH2HGoals > 2.5 && odds_over < 2.05) {
        rekom_ou = `Over ${ou_line}`;
        ou_conf = 70 + (GPI * 5);
      } else if (totalGoals < ou_line && avgH2HGoals < 2.3 && odds_under < 2.05) {
        rekom_ou = `Under ${ou_line}`;
        ou_conf = 68 + (Math.abs(GPI) * 4);
      }

      // BTTS Probability
      let probBTTS = (1 - poisson(expHome, 0)) * (1 - poisson(expAway, 0));
      let rekom_btts = probBTTS > 0.55 ? "BTTS Yes" : "BTTS No";
      let btts_conf = (probBTTS * 100).toFixed(1);

      // Poisson Probabilities (multi-skor)
      let skorProb = [];
      for (let i = 0; i <= 4; i++) {
        for (let j = 0; j <= 4; j++) {
          let prob = poisson(expHome, i) * poisson(expAway, j);
          skorProb.push({ skor: `${i}-${j}`, prob: prob });
        }
      }
      skorProb.sort((a, b) => b.prob - a.prob);
      let topSkor = skorProb.slice(0, 3).map(s => `${s.skor} (${(s.prob*100).toFixed(1)}%)`).join(", ");

      // Market Trap Detector
      let trapNote = "";
      if ((rekom_ou.includes("Over") && odds_under < odds_over) ||
          (rekom_ou.includes("Under") && odds_over < odds_under)) {
        trapNote = "‚ö†Ô∏è Potensi jebakan pasar terdeteksi pada O/U!";
      }

      // Narasi
      let narasi = "";
      if (ADI_home > ADI_away) narasi += `${home} lebih unggul dari sisi serangan vs pertahanan lawan. `;
      if (ADI_away > ADI_home) narasi += `${away} berpotensi merepotkan dengan serangan lebih tajam. `;
      if (GPI > 1) narasi += "Laga cenderung terbuka (potensi banyak gol). ";
      if (GPI < -0.5) narasi += "Pertandingan cenderung ketat & minim gol. ";
      if (probBTTS > 0.55) narasi += "Peluang besar kedua tim sama-sama mencetak gol. ";

      // Confidence Tier
      let hdpTier = tier(hdp_conf);
      let ouTier = tier(ou_conf);

      output += `<div class="${hdpTier.css}">üëâ HDP: <b>${rekom_hdp}</b> (${hdpTier.label}, ${hdp_conf.toFixed(1)}%)</div>`;
      output += `<div class="${ouTier.css}">üëâ O/U: <b>${rekom_ou}</b> (${ouTier.label}, ${ou_conf.toFixed(1)}%)</div>`;
      output += `<div class="card">‚öΩ Skor Probabilitas: ${topSkor}<br>
      üî¢ Exp Goals ‚Üí Home: ${expHome.toFixed(2)} | Away: ${expAway.toFixed(2)} | Total: ${totalGoals.toFixed(2)}<br>
      üìä ADI Home: ${ADI_home.toFixed(2)} | ADI Away: ${ADI_away.toFixed(2)}<br>
      üìä SBI: ${SBI.toFixed(2)} | GPI: ${GPI.toFixed(2)} | H2H Avg Goals: ${avgH2HGoals.toFixed(2)}<br>
      üéØ ${rekom_btts} (Confidence ${btts_conf}%)<br>
      üìù Analisis: ${narasi}<br>
      ${trapNote}<br>
      üîó Kombinasi Terbaik: ${rekom_hdp} + ${rekom_ou}</div>`;

      document.getElementById('output').innerHTML = output;
    }
  </script>
</body>
</html>
