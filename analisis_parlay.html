<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Kalkulator HDP, O/U, Value Bet & Odds Trap</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
    h2 { color: #222; }
    .form-group { margin-bottom: 12px; }
    label { display: block; font-weight: bold; margin-bottom: 5px; }
    input, select { padding: 6px; width: 260px; }
    button { padding: 10px 16px; margin-top: 12px; cursor: pointer; background: #007bff; color: #fff; border: none; border-radius: 5px; }
    button:hover { background: #0056b3; }
    #result { margin-top: 20px; padding: 15px; background: #fff; border: 1px solid #ccc; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>‚öΩ Kalkulator HDP, O/U, Value Bet & Odds Trap</h2>

  <!-- Pilih Liga -->
  <div class="form-group">
    <label for="leagueSelect">Pilih Liga / Kompetisi</label>
    <select id="leagueSelect"></select>
  </div>

  <div class="form-group">
    <label>League Avg (otomatis)</label>
    <input id="leagueAvg" type="number" readonly>
  </div>

  <!-- Input Statistik Tim -->
  <h3>üìä Statistik Tim</h3>
  <div class="form-group">
    <label>Home GF (gol per laga)</label>
    <input id="homeGF" type="number" step="0.01">
  </div>
  <div class="form-group">
    <label>Home GA (kebobolan per laga)</label>
    <input id="homeGA" type="number" step="0.01">
  </div>
  <div class="form-group">
    <label>Away GF (gol per laga)</label>
    <input id="awayGF" type="number" step="0.01">
  </div>
  <div class="form-group">
    <label>Away GA (kebobolan per laga)</label>
    <input id="awayGA" type="number" step="0.01">
  </div>

  <!-- Input Odds Pasar -->
  <h3>üßæ Odds Pasar</h3>
  <div class="form-group">
    <label>Odds Over 2.5</label>
    <input id="oddsOver" type="number" step="0.01" value="1.90">
  </div>
  <div class="form-group">
    <label>Odds Under 2.5</label>
    <input id="oddsUnder" type="number" step="0.01" value="1.90">
  </div>
  <div class="form-group">
    <label>Odds Home Win</label>
    <input id="oddsHome" type="number" step="0.01" value="2.20">
  </div>
  <div class="form-group">
    <label>Odds Draw</label>
    <input id="oddsDraw" type="number" step="0.01" value="3.20">
  </div>
  <div class="form-group">
    <label>Odds Away Win</label>
    <input id="oddsAway" type="number" step="0.01" value="3.10">
  </div>

  <!-- Input HDP -->
  <h3>üèüÔ∏è Handicap (HDP)</h3>
  <div class="form-group">
    <label>Line HDP (misalnya -0.5, +0.25, dst)</label>
    <input id="hdpLine" type="number" step="0.25" value="-0.5">
  </div>
  <div class="form-group">
    <label>Odds Home (HDP)</label>
    <input id="oddsHdpHome" type="number" step="0.01" value="1.92">
  </div>
  <div class="form-group">
    <label>Odds Away (HDP)</label>
    <input id="oddsHdpAway" type="number" step="0.01" value="1.98">
  </div>

  <button onclick="analyze()">üîé Analisis</button>

  <div id="result"></div>

<script>
  ,
  // ================== DATA LIGA LENGKAP ==================
const leagueMeta = {
  // üá¨üáß Inggris
  "Premier League": {avg:2.65, baseK:1.8, homeBias:0.12, reliability:0.70},
  "Championship": {avg:2.45, baseK:1.6, homeBias:0.10, reliability:0.65},
  "FA Cup": {avg:3.20, baseK:1.8, homeBias:0.05, reliability:0.60},
  "EFL Cup (Carabao Cup)": {avg:3.10, baseK:1.7, homeBias:0.05, reliability:0.60},

  // üá™üá∏ Spanyol
  "La Liga": {avg:2.62, baseK:1.6, homeBias:0.10, reliability:0.70},
  "Segunda Divisi√≥n": {avg:2.55, baseK:1.5, homeBias:0.08, reliability:0.65},
  "Copa del Rey": {avg:2.95, baseK:1.7, homeBias:0.05, reliability:0.60},

  // üáÆüáπ Italia
  "Serie A": {avg:2.56, baseK:1.6, homeBias:0.08, reliability:0.65},
  "Serie B": {avg:2.47, baseK:1.5, homeBias:0.08, reliability:0.60},
  "Coppa Italia": {avg:3.00, baseK:1.8, homeBias:0.05, reliability:0.60},

  // üá©üá™ Jerman
  "Bundesliga": {avg:3.14, baseK:2.0, homeBias:0.12, reliability:0.75},
  "2. Bundesliga": {avg:3.02, baseK:1.9, homeBias:0.10, reliability:0.70},
  "DFB-Pokal": {avg:4.19, baseK:2.2, homeBias:0.05, reliability:0.55},

  // üá´üá∑ Prancis
  "Ligue 1": {avg:2.96, baseK:1.7, homeBias:0.10, reliability:0.65},
  "Ligue 2": {avg:2.41, baseK:1.5, homeBias:0.08, reliability:0.60},
  "Coupe de France": {avg:3.20, baseK:1.8, homeBias:0.05, reliability:0.55},

  // üá≥üá± Belanda
  "Eredivisie": {avg:2.98, baseK:1.8, homeBias:0.10, reliability:0.65},
  "Eerste Divisie": {avg:3.10, baseK:1.9, homeBias:0.08, reliability:0.60},
  "KNVB Cup": {avg:3.80, baseK:2.0, homeBias:0.05, reliability:0.55},

  // üáµüáπ Portugal
  "Primeira Liga": {avg:2.87, baseK:1.7, homeBias:0.08, reliability:0.65},
  "Ta√ßa de Portugal": {avg:2.90, baseK:1.8, homeBias:0.05, reliability:0.60},

  // üá®üá≠ Swiss
  "Swiss Super League": {avg:3.33, baseK:2.0, homeBias:0.10, reliability:0.65},
  "Swiss Cup": {avg:3.50, baseK:2.0, homeBias:0.05, reliability:0.55},

  // üáπüá∑ Turki
  "S√ºper Lig": {avg:2.94, baseK:1.7, homeBias:0.10, reliability:0.65},
  "Turkish Cup": {avg:2.90, baseK:1.8, homeBias:0.05, reliability:0.55},

  // üá¨üá∑ Yunani
  "Super League Greece": {avg:2.97, baseK:1.6, homeBias:0.10, reliability:0.65},
  "Greek Cup": {avg:2.30, baseK:1.5, homeBias:0.05, reliability:0.55},

  // üá∑üá∫ Rusia
  "Russian Premier League": {avg:2.70, baseK:1.6, homeBias:0.08, reliability:0.65},
  "Russian Cup": {avg:2.80, baseK:1.7, homeBias:0.05, reliability:0.55},

  // üá∑üá¥ Rumania
  "Liga I": {avg:2.67, baseK:1.6, homeBias:0.08, reliability:0.65},
  "Cupa Rom√¢niei": {avg:3.20, baseK:1.8, homeBias:0.05, reliability:0.55},

  // üáµüá± Polandia
  "Ekstraklasa": {avg:2.85, baseK:1.6, homeBias:0.08, reliability:0.65},
  "Polish Cup": {avg:2.90, baseK:1.7, homeBias:0.05, reliability:0.55},

  // üá≠üá∑ Kroasia
  "HNL": {avg:2.36, baseK:1.5, homeBias:0.08, reliability:0.60},
  "Croatian Cup": {avg:3.10, baseK:1.7, homeBias:0.05, reliability:0.55},

  // üá±üáª Latvia
  "Latvia Higher League": {avg:2.89, baseK:1.6, homeBias:0.08, reliability:0.60},
  "Latvian Cup": {avg:4.90, baseK:2.2, homeBias:0.05, reliability:0.50},

  // üá™üá™ Estonia
  "Meistriliiga": {avg:3.22, baseK:1.8, homeBias:0.08, reliability:0.60},
  "Estonian Cup": {avg:4.50, baseK:2.2, homeBias:0.05, reliability:0.50},

  // üá∏üá™ Swedia
  "Allsvenskan": {avg:2.83, baseK:1.6, homeBias:0.08, reliability:0.65},
  "Svenska Cupen": {avg:3.10, baseK:1.7, homeBias:0.05, reliability:0.55},

  // üá≥üá¥ Norwegia
  "Eliteserien": {avg:2.83, baseK:1.6, homeBias:0.08, reliability:0.65},
  "Norwegian Cup": {avg:3.60, baseK:1.9, homeBias:0.05, reliability:0.55},

  // üá©üá∞ Denmark
  "Superliga": {avg:3.27, baseK:1.8, homeBias:0.08, reliability:0.65},
  "1st Division": {avg:2.81, baseK:1.6, homeBias:0.08, reliability:0.60},
  "Danish Cup": {avg:4.00, baseK:2.0, homeBias:0.05, reliability:0.55},

  // üá´üáÆ Finlandia
  "Veikkausliiga": {avg:2.93, baseK:1.7, homeBias:0.08, reliability:0.65},
  "Ykk√∂sliiga": {avg:3.02, baseK:1.7, homeBias:0.08, reliability:0.60},
  "Ykk√∂nen": {avg:3.51, baseK:1.9, homeBias:0.08, reliability:0.60},
  "Suomen Cup": {avg:4.00, baseK:2.0, homeBias:0.05, reliability:0.55},

  // üáÆüá∏ Islandia
  "√örvalsdeild": {avg:3.62, baseK:2.0, homeBias:0.08, reliability:0.60},
  "Icelandic Cup": {avg:5.00, baseK:2.3, homeBias:0.05, reliability:0.50},

  // üáÆüá™ Irlandia
  "Premier Division": {avg:2.26, baseK:1.5, homeBias:0.08, reliability:0.60},
  "FAI Cup": {avg:3.00, baseK:1.7, homeBias:0.05, reliability:0.55},

  // üåç Kompetisi UEFA
  "UEFA Champions League": {avg:3.10, baseK:2.0, homeBias:0.00, reliability:0.75},
  "UEFA Europa League": {avg:2.85, baseK:1.8, homeBias:0.00, reliability:0.70},
  "UEFA Conference League": {avg:2.71, baseK:1.7, homeBias:0.00, reliability:0.65},

  // üåç Turnamen Dunia
  "World Cup": {avg:2.70, baseK:1.6, homeBias:0.00, reliability:0.80}
};

// ================== ISI DROPDOWN LIGA ==================
window.onload = function() {
  const sel = document.getElementById('leagueSelect');
  for (let liga in leagueMeta) {
    let opt = document.createElement("option");
    opt.value = liga;
    opt.text = liga;
    sel.appendChild(opt);
  }
  sel.selectedIndex = 0;
  document.getElementById('leagueAvg').value = leagueMeta[sel.value].avg;
  sel.addEventListener("change", function() {
    document.getElementById('leagueAvg').value = leagueMeta[this.value].avg;
  });
};
// ================== PERHITUNGAN (Lambda, Distribusi, HDP) ==================
function calculateLambda(homeGF, homeGA, awayGF, awayGA, meta, h2hAdj=0) {
  const leagueFactor = meta.avg / 2.5;
  const homeAdv = 1 + meta.homeBias;
  const relAdj = 0.5 + meta.reliability * 0.5;

  let lambdaHome = ((homeGF*0.6 + awayGA*0.4)) * leagueFactor * homeAdv * relAdj;
  let lambdaAway = ((awayGF*0.6 + homeGA*0.4)) * leagueFactor * relAdj;

  if (h2hAdj !== 0) {
    lambdaHome += h2hAdj > 0 ? h2hAdj*0.1 : 0;
    lambdaAway += h2hAdj < 0 ? Math.abs(h2hAdj)*0.1 : 0;
  }
  return { lambdaHome, lambdaAway };
}

// ================== Distribusi Dasar ==================
function factorial(n){ return n? n*factorial(n-1):1; }
function poissonPMF(k, lambda){ return Math.pow(lambda,k)*Math.exp(-lambda)/factorial(k); }

// ================== HDP Probabilitas ==================
function hdpProbability(marginMean, sigma, line) {
  function cdf(x) { return 0.5 * (1 + erf(x / Math.sqrt(2))); }
  function erf(x) {
    let sign = (x>=0)?1:-1; x=Math.abs(x);
    let a1=0.254829592, a2=-0.284496736, a3=1.421413741,
        a4=-1.453152027, a5=1.061405429, p=0.3275911;
    let t=1/(1+p*x);
    let y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-x*x);
    return sign*y;
  }
  let zHome = (marginMean - line) / sigma;
  let pHome = cdf(zHome);
  return {home: pHome, away: 1 - pHome};
}

// ================== Value Bet Threshold ==================
function getValueThresh(meta) {
  if (meta.avg > 3.0) return 0.08;  // Liga produktif ‚Üí butuh selisih lebih besar
  if (meta.avg < 2.5) return 0.03;  // Liga ketat ‚Üí selisih kecil sudah cukup
  return 0.05;                       // Moderat default
}

// ================== Deteksi Odds Trap ==================
function detectOddsTrap(prob, odds) {
  if (!odds || odds <= 1.01) return null;
  const implied = 1 / odds;
  const diff = prob - implied;
  if (Math.abs(diff) > 0.15) { 
    return diff > 0 ? "üî• Potensi Value (Trap Risiko)" : "‚ö†Ô∏è Trap Market";
  }
  return null;
  }
  // ================== ANALISIS & OUTPUT ==================
function computeProbabilities(lambdaHome, lambdaAway) {
  let maxGoals = 6;
  let over=0, under=0, totalProb=0;
  let homeWin=0, draw=0, awayWin=0;
  let expectedMargin=0, variance=0;

  for (let i=0;i<=maxGoals;i++){
    for (let j=0;j<=maxGoals;j++){
      let p = poissonPMF(i, lambdaHome) * poissonPMF(j, lambdaAway);
      totalProb+=p;
      expectedMargin+=(i-j)*p;
      variance+=Math.pow(i-j,2)*p;

      if (i>j) homeWin+=p; 
      else if (i===j) draw+=p; 
      else awayWin+=p;

      if (i+j>2.5) over+=p; else under+=p;
    }
  }
  return {
    over: over/totalProb,
    under: under/totalProb,
    homeWin: homeWin/totalProb,
    draw: draw/totalProb,
    awayWin: awayWin/totalProb,
    margin: expectedMargin/totalProb,
    sigma: Math.sqrt(variance/totalProb - Math.pow(expectedMargin/totalProb,2))
  };
}

function analyze() {
  const league = document.getElementById('leagueSelect').value;
  const meta = leagueMeta[league];

  // input statistik
  const homeGF = parseFloat(document.getElementById('homeGF').value);
  const homeGA = parseFloat(document.getElementById('homeGA').value);
  const awayGF = parseFloat(document.getElementById('awayGF').value);
  const awayGA = parseFloat(document.getElementById('awayGA').value);

  // input odds
  const oddsOver = parseFloat(document.getElementById('oddsOver').value);
  const oddsUnder = parseFloat(document.getElementById('oddsUnder').value);
  const oddsHome = parseFloat(document.getElementById('oddsHome').value);
  const oddsDraw = parseFloat(document.getElementById('oddsDraw').value);
  const oddsAway = parseFloat(document.getElementById('oddsAway').value);
  const hdpLine = parseFloat(document.getElementById('hdpLine').value);
  const oddsHdpHome = parseFloat(document.getElementById('oddsHdpHome').value);
  const oddsHdpAway = parseFloat(document.getElementById('oddsHdpAway').value);

  // hitung lambda
  const {lambdaHome, lambdaAway} = calculateLambda(homeGF, homeGA, awayGF, awayGA, meta);
  const probs = computeProbabilities(lambdaHome, lambdaAway);

  // probabilitas HDP
  const hdpProbs = hdpProbability(probs.margin, probs.sigma, hdpLine);

  // threshold value bet
  const valueThresh = getValueThresh(meta);

  // odds trap check
  let trapOver = detectOddsTrap(probs.over, oddsOver);
  let trapUnder = detectOddsTrap(probs.under, oddsUnder);
  let trapHome = detectOddsTrap(probs.homeWin, oddsHome);
  let trapDraw = detectOddsTrap(probs.draw, oddsDraw);
  let trapAway = detectOddsTrap(probs.awayWin, oddsAway);
  let trapHdpHome = detectOddsTrap(hdpProbs.home, oddsHdpHome);
  let trapHdpAway = detectOddsTrap(hdpProbs.away, oddsHdpAway);

  // hasil analisis
  let html = `<h3>üìà Hasil Analisis (${league})</h3>`;
  html += `<p>Lambda Home: ${lambdaHome.toFixed(2)} | Lambda Away: ${lambdaAway.toFixed(2)}</p>`;
  html += `<p>Probabilitas Over 2.5: ${(probs.over*100).toFixed(1)}% | Under 2.5: ${(probs.under*100).toFixed(1)}%</p>`;
  html += `<p>Probabilitas 1X2 ‚Üí Home: ${(probs.homeWin*100).toFixed(1)}% | Draw: ${(probs.draw*100).toFixed(1)}% | Away: ${(probs.awayWin*100).toFixed(1)}%</p>`;
  html += `<p>HDP (${hdpLine}) ‚Üí Home: ${(hdpProbs.home*100).toFixed(1)}% | Away: ${(hdpProbs.away*100).toFixed(1)}%</p>`;

  // value bet cek
  function checkValue(prob, odds, label) {
    if (!odds || odds<=1.01) return "";
    const implied = 1/odds;
    if (prob - implied > valueThresh) {
      return `<p>üí∞ Value Bet terdeteksi di ${label} (Prob: ${(prob*100).toFixed(1)}% | Odds: ${odds})</p>`;
    }
    return "";
  }
  html += checkValue(probs.over, oddsOver, "Over 2.5");
  html += checkValue(probs.under, oddsUnder, "Under 2.5");
  html += checkValue(probs.homeWin, oddsHome, "Home Win");
  html += checkValue(probs.draw, oddsDraw, "Draw");
  html += checkValue(probs.awayWin, oddsAway, "Away Win");
  html += checkValue(hdpProbs.home, oddsHdpHome, "HDP Home");
  html += checkValue(hdpProbs.away, oddsHdpAway, "HDP Away");

  // odds trap warning
  if (trapOver) html += `<p>üö® Over Trap: ${trapOver}</p>`;
  if (trapUnder) html += `<p>üö® Under Trap: ${trapUnder}</p>`;
  if (trapHome) html += `<p>üö® Home Trap: ${trapHome}</p>`;
  if (trapDraw) html += `<p>üö® Draw Trap: ${trapDraw}</p>`;
  if (trapAway) html += `<p>üö® Away Trap: ${trapAway}</p>`;
  if (trapHdpHome) html += `<p>üö® HDP Home Trap: ${trapHdpHome}</p>`;
  if (trapHdpAway) html += `<p>üö® HDP Away Trap: ${trapHdpAway}</p>`;

  document.getElementById("result").innerHTML = html;
  }
  </script>
</body>
</html>
