<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Kalkulator HDP, O/U, Value Bet & Odds Trap — Full</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --muted:#6b7280; --accent:#0b74ff;
    }
    body{
      font-family: Inter, "Segoe UI", Arial, sans-serif;
      background: var(--bg);
      color: #111;
      margin: 18px;
    }
    .wrap{ max-width:1100px; margin:0 auto; }
    .card{
      background: var(--card);
      border:1px solid #e6e9ef;
      padding:16px;
      border-radius:10px;
      box-shadow:0 8px 30px rgba(2,6,23,0.04);
    }
    h1{ margin:0 0 8px; font-size:20px; }
    .small{ font-size:13px; color:var(--muted); }
    .row{ display:flex; gap:12px; flex-wrap:wrap; margin-top:12px; }
    .col{ flex:1; min-width:220px; }
    label{ display:block; font-weight:600; margin-bottom:6px; }
    input, select, button, textarea{
      padding:8px 10px;
      border:1px solid #d1d5db;
      border-radius:8px;
      font-size:14px;
      width:100%;
      box-sizing:border-box;
    }
    button{ background:var(--accent); color:#fff; border:none; cursor:pointer; }
    button.secondary{ background:#eef2ff; color:#0b3ca6; border:1px solid #dbeafe; }
    #result{
      margin-top:14px;
      white-space:pre-wrap;
      padding:12px;
      background:#fbfdff;
      border-radius:8px;
      border:1px solid #edf2ff;
    }
    .muted{ color:var(--muted); font-size:13px; }
    .note{ font-size:13px; color:#374151; margin-top:8px; }
    code{ font-family:monospace; background:#f3f4f6; padding:2px 6px; border-radius:4px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>⚽ Kalkulator HDP, O/U, Value Bet & Odds Trap — Full</h1>
      <div class="small">Versi lengkap. Isi data manual — nanti bagian 2/3/4 menyambung dan menjalankan perhitungan di browser.</div>

      <hr />

      <div class="row">
        <div class="col">
          <label for="leagueSelect">Pilih Liga / Kompetisi</label>
          <select id="leagueSelect">
            <option value="Premier League">Premier League</option>
            <option value="Championship">Championship</option>
            <option value="FA Cup">FA Cup</option>
            <option value="EFL Cup (Carabao Cup)">EFL Cup (Carabao Cup)</option>
            <option value="La Liga">La Liga</option>
            <option value="Segunda División">Segunda División</option>
            <option value="Copa del Rey">Copa del Rey</option>
            <option value="Serie A">Serie A</option>
            <option value="Serie B">Serie B</option>
            <option value="Coppa Italia">Coppa Italia</option>
            <option value="Bundesliga">Bundesliga</option>
            <option value="2. Bundesliga">2. Bundesliga</option>
            <option value="DFB-Pokal">DFB-Pokal</option>
            <option value="Ligue 1">Ligue 1</option>
            <option value="Ligue 2">Ligue 2</option>
            <option value="Coupe de France">Coupe de France</option>
            <option value="Eredivisie">Eredivisie</option>
            <option value="Eerste Divisie">Eerste Divisie</option>
            <option value="KNVB Cup">KNVB Cup</option>
            <option value="Primeira Liga">Primeira Liga</option>
            <option value="Taça de Portugal">Taça de Portugal</option>
            <option value="Swiss Super League">Swiss Super League</option>
            <option value="Swiss Cup">Swiss Cup</option>
            <option value="Süper Lig">Süper Lig</option>
            <option value="Turkish Cup">Turkish Cup</option>
            <option value="Super League Greece">Super League Greece</option>
            <option value="Greek Cup">Greek Cup</option>
            <option value="Russian Premier League">Russian Premier League</option>
            <option value="Russian Cup">Russian Cup</option>
            <option value="Liga I">Liga I</option>
            <option value="Cupa României">Cupa României</option>
            <option value="Ekstraklasa">Ekstraklasa</option>
            <option value="Polish Cup">Polish Cup</option>
            <option value="HNL">HNL</option>
            <option value="Croatian Cup">Croatian Cup</option>
            <option value="Latvia Higher League">Latvia Higher League</option>
            <option value="Latvian Cup">Latvian Cup</option>
            <option value="Meistriliiga">Meistriliiga</option>
            <option value="Estonian Cup">Estonian Cup</option>
            <option value="Allsvenskan">Allsvenskan</option>
            <option value="Svenska Cupen">Svenska Cupen</option>
            <option value="Eliteserien">Eliteserien</option>
            <option value="Norwegian Cup">Norwegian Cup</option>
            <option value="Superliga">Superliga (Denmark)</option>
            <option value="1st Division">1st Division</option>
            <option value="Danish Cup">Danish Cup</option>
            <option value="Veikkausliiga">Veikkausliiga</option>
            <option value="Ykkösliiga">Ykkösliiga</option>
            <option value="Ykkönen">Ykkönen</option>
            <option value="Suomen Cup">Suomen Cup</option>
            <option value="Úrvalsdeild">Úrvalsdeild</option>
            <option value="Icelandic Cup">Icelandic Cup</option>
            <option value="Premier Division">Premier Division (IRL)</option>
            <option value="FAI Cup">FAI Cup</option>
            <option value="UEFA Champions League">UEFA Champions League</option>
            <option value="UEFA Europa League">UEFA Europa League</option>
            <option value="UEFA Conference League">UEFA Conference League</option>
            <option value="World Cup">World Cup</option>
          </select>

          <div style="margin-top:8px">
            <label>League Avg (otomatis)</label>
            <input id="leagueAvg" type="number" readonly />
          </div>
        </div>

        <div class="col">
          <label>Home GF (gol per laga)</label>
          <input id="homeGF" type="number" step="0.01" placeholder="contoh: 1.45" />
          <label style="margin-top:8px">Home GA (kebobolan per laga)</label>
          <input id="homeGA" type="number" step="0.01" placeholder="contoh: 1.20" />
        </div>

        <div class="col">
          <label>Away GF (gol per laga)</label>
          <input id="awayGF" type="number" step="0.01" placeholder="contoh: 1.30" />
          <label style="margin-top:8px">Away GA (kebobolan per laga)</label>
          <input id="awayGA" type="number" step<hr />

      <div class="row">
        <div class="col">
          <label>Odds Over 2.5</label>
          <input id="oddsOver" type="number" step="0.01" value="1.90" />
          <label style="margin-top:8px">Odds Under 2.5</label>
          <input id="oddsUnder" type="number" step="0.01" value="1.90" />
        </d<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Kalkulator HDP, O/U, Value Bet & Odds Trap — Full</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --muted:#6b7280; --accent:#0b74ff;
    }
    body{
      font-family: Inter, "Segoe UI", Arial, sans-serif;
      background: var(--bg);
      color: #111;
      margin: 18px;
    }
    .wrap{ max-width:1100px; margin:0 auto; }
    .card{
      background: var(--card);
      border:1px solid #e6e9ef;
      padding:16px;
      border-radius:10px;
      box-shadow:0 8px 30px rgba(2,6,23,0.04);
    }
    h1{ margin:0 0 8px; font-size:20px; }
    .small{ font-size:13px; color:var(--muted); }
    .row{ display:flex; gap:12px; flex-wrap:wrap; margin-top:12px; }
    .col{ flex:1; min-width:220px; }
    label{ display:block; font-weight:600; margin-bottom:6px; }
    input, select, button, textarea{
      padding:8px 10px;
      border:1px solid #d1d5db;
      border-radius:8px;
      font-size:14px;
      width:100%;
      box-sizing:border-box;
    }
    button{ background:var(--accent); color:#fff; border:none; cursor:pointer; }
    button.secondary{ background:#eef2ff; color:#0b3ca6; border:1px solid #dbeafe; }
    #result{
      margin-top:14px;
      white-space:pre-wrap;
      padding:12px;
      background:#fbfdff;
      border-radius:8px;
      border:1px solid #edf2ff;
    }
    .muted{ color:var(--muted); font-size:13px; }
    .note{ font-size:13px; color:#374151; margin-top:8px; }
    code{ font-family:monospace; background:#f3f4f6; padding:2px 6px; border-radius:4px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>⚽ Kalkulator HDP, O/U, Value Bet & Odds Trap — Full</h1>
      <div class="small">Versi lengkap. Isi data manual — nanti bagian 2/3/4 menyambung dan menjalankan perhitungan di browser.</div>

      <hr />

      <div class="row">
        <div class="col">
          <label for="leagueSelect">Pilih Liga / Kompetisi</label>
          <select id="leagueSelect">
            <option value="Premier League">Premier League</option>
            <option value="Championship">Championship</option>
            <option value="FA Cup">FA Cup</option>
            <option value="EFL Cup (Carabao Cup)">EFL Cup (Carabao Cup)</option>
            <option value="La Liga">La Liga</option>
            <option value="Segunda División">Segunda División</option>
            <option value="Copa del Rey">Copa del Rey</option>
            <option value="Serie A">Serie A</option>
            <option value="Serie B">Serie B</option>
            <option value="Coppa Italia">Coppa Italia</option>
            <option value="Bundesliga">Bundesliga</option>
            <option value="2. Bundesliga">2. Bundesliga</option>
            <option value="DFB-Pokal">DFB-Pokal</option>
            <option value="Ligue 1">Ligue 1</option>
            <option value="Ligue 2">Ligue 2</option>
            <option value="Coupe de France">Coupe de France</option>
            <option value="Eredivisie">Eredivisie</option>
            <option value="Eerste Divisie">Eerste Divisie</option>
            <option value="KNVB Cup">KNVB Cup</option>
            <option value="Primeira Liga">Primeira Liga</option>
            <option value="Taça de Portugal">Taça de Portugal</option>
            <option value="Swiss Super League">Swiss Super League</option>
            <option value="Swiss Cup">Swiss Cup</option>
            <option value="Süper Lig">Süper Lig</option>
            <option value="Turkish Cup">Turkish Cup</option>
            <option value="Super League Greece">Super League Greece</option>
            <option value="Greek Cup">Greek Cup</option>
            <option value="Russian Premier League">Russian Premier League</option>
            <option value="Russian Cup">Russian Cup</option>
            <option value="Liga I">Liga I</option>
            <option value="Cupa României">Cupa României</option>
            <option value="Ekstraklasa">Ekstraklasa</option>
            <option value="Polish Cup">Polish Cup</option>
            <option value="HNL">HNL</option>
            <option value="Croatian Cup">Croatian Cup</option>
            <option value="Latvia Higher League">Latvia Higher League</option>
            <option value="Latvian Cup">Latvian Cup</option>
            <option value="Meistriliiga">Meistriliiga</option>
            <option value="Estonian Cup">Estonian Cup</option>
            <option value="Allsvenskan">Allsvenskan</option>
            <option value="Svenska Cupen">Svenska Cupen</option>
            <option value="Eliteserien">Eliteserien</option>
            <option value="Norwegian Cup">Norwegian Cup</option>
            <option value="Superliga">Superliga (Denmark)</option>
            <option value="1st Division">1st Division</option>
            <option value="Danish Cup">Danish Cup</option>
            <option value="Veikkausliiga">Veikkausliiga</option>
            <option value="Ykkösliiga">Ykkösliiga</option>
            <option value="Ykkönen">Ykkönen</option>
            <option value="Suomen Cup">Suomen Cup</option>
            <option value="Úrvalsdeild">Úrvalsdeild</option>
            <option value="Icelandic Cup">Icelandic Cup</option>
            <option value="Premier Division">Premier Division (IRL)</option>
            <option value="FAI Cup">FAI Cup</option>
            <option value="UEFA Champions League">UEFA Champions League</option>
            <option value="UEFA Europa League">UEFA Europa League</option>
            <option value="UEFA Conference League">UEFA Conference League</option>
            <option value="World Cup">World Cup</option>
          </select>

          <div style="margin-top:8px">
            <label>League Avg (otomatis)</label>
            <input id="leagueAvg" type="number" readonly />
          </div>
        </div>

        <div class="col">
          <label>Home GF (gol per laga)</label>
          <input id="homeGF" type="number" step="0.01" placeholder="contoh: 1.45" />
          <label style="margin-top:8px">Home GA (kebobolan per laga)</label>
          <input id="homeGA" type="number" step="0.01" placeholder="contoh: 1.20" />
        </div>

        <div class="col">
          <label>Away GF (gol per laga)</label>
          <input id="awayGF" type="number" step="0.01" placeholder="contoh: 1.30" />
          <label style="margin-top:8px">Away GA (kebobolan per laga)</label>
          <input id="awayGA" type="number" step="0.01" placeholder="contoh: 1.40" />
        </div>
  </div>

        <hr />

      <div class="row">
        <div class="col">
          <label>Odds Over 2.5</label>
          <input id="oddsOver" type="number" step="0.01" value="1.90" />
          <label style="margin-top:8px">Odds Under 2.5</label>
          <input id="oddsUnder" type="number" step="0.01" value="1.90" />
        </div>

        <div class="col">
          <label>Odds Home Win</label>
          <input id="oddsHome" type="number" step="0.01" value="2.20" />
          <label style="margin-top:8px">Odds Draw</label>
          <input id="oddsDraw" type="number" step="0.01" value="3.20" />
        </div>

        <div class="col">
          <label>Odds Away Win</label>
          <input id="oddsAway" type="number" step="0.01" value="3.10" />
          <label style="margin-top:8px">Value Bet Threshold (%)</label>
          <input id="valueThreshPercent" type="number" step="0.1" value="5" />
        </div>
      </div>

      <hr />

      <div class="row">
        <div class="col">
          <label>Line HDP (mis. -0.5, +0.25, dst)</label>
          <input id="hdpLine" type="number" step="0.25" value="-0.5" />
        </div>
        <div class="col">
          <label>Odds Home (HDP)</label>
          <input id="oddsHdpHome" type="number" step="0.01" value="1.92" />
        </div>
        <div class="col">
          <label>Odds Away (HDP)</label>
          <input id="oddsHdpAway" type="number" step="0.01" value="1.98" />
        </div>
      </div>

      <div style="margin-top:12px">
        <button id="btnAnalyze">🔎 Analisis Sekarang</button>
        <button id="btnReset" class="secondary" style="margin-left:8px">Reset</button>
      </div>

      <div id="result"></div>


 <script>
const leagueMeta = {
  "Premier League": { avg:2.65, baseK:1.2, homeBias:0.08, reliability:0.9 },
  "Championship": { avg:2.45, baseK:1.2, homeBias:0.07, reliability:0.85 },
  "FA Cup": { avg:3.20, baseK:1.25, homeBias:0.05, reliability:0.7 },
  "EFL Cup (Carabao Cup)": { avg:3.10, baseK:1.25, homeBias:0.05, reliability:0.7 },

  "La Liga": { avg:2.62, baseK:1.2, homeBias:0.07, reliability:0.9 },
  "Segunda División": { avg:2.55, baseK:1.2, homeBias:0.07, reliability:0.85 },
  "Copa del Rey": { avg:2.95, baseK:1.25, homeBias:0.05, reliability:0.75 },

  "Serie A": { avg:2.56, baseK:1.2, homeBias:0.07, reliability:0.9 },
  "Serie B": { avg:2.47, baseK:1.2, homeBias:0.07, reliability:0.85 },
  "Coppa Italia": { avg:3.00, baseK:1.25, homeBias:0.05, reliability:0.75 },

  "Bundesliga": { avg:3.14, baseK:1.25, homeBias:0.09, reliability:0.95 },
  "2. Bundesliga": { avg:3.02, baseK:1.2, homeBias:0.08, reliability:0.9 },
  "DFB-Pokal": { avg:4.19, baseK:1.3, homeBias:0.05, reliability:0.7 },

  "Ligue 1": { avg:2.96, baseK:1.2, homeBias:0.07, reliability:0.9 },
  "Ligue 2": { avg:2.41, baseK:1.2, homeBias:0.06, reliability:0.85 },
  "Coupe de France": { avg:3.20, baseK:1.25, homeBias:0.05, reliability:0.7 },

  "Eredivisie": { avg:2.98, baseK:1.2, homeBias:0.08, reliability:0.9 },
  "Eerste Divisie": { avg:3.10, baseK:1.25, homeBias:0.07, reliability:0.85 },
  "KNVB Cup": { avg:3.80, baseK:1.3, homeBias:0.05, reliability:0.7 },

  "Primeira Liga": { avg:2.87, baseK:1.2, homeBias:0.07, reliability:0.9 },
  "Taça de Portugal": { avg:2.90, baseK:1.25, homeBias:0.05, reliability:0.75 },

  "Swiss Super League": { avg:3.33, baseK:1.25, homeBias:0.08, reliability:0.9 },
  "Swiss Cup": { avg:3.50, baseK:1.25, homeBias:0.05, reliability:0.7 },

  "Süper Lig": { avg:2.94, baseK:1.2, homeBias:0.07, reliability:0.9 },
  "Turkish Cup": { avg:2.90, baseK:1.25, homeBias:0.05, reliability:0.75 },

  "Super League Greece": { avg:2.97, baseK:1.2, homeBias:0.07, reliability:0.85 },
  "Greek Cup": { avg:2.30, baseK:1.2, homeBias:0.05, reliability:0.7 },

  "Russian Premier League": { avg:2.70, baseK:1.2, homeBias:0.07, reliability:0.85 },
  "Russian Cup": { avg:2.80, baseK:1.25, homeBias:0.05, reliability:0.75 },

  "Liga I": { avg:2.67, baseK:1.2, homeBias:0.07, reliability:0.85 },
  "Cupa României": { avg:3.20, baseK:1.25, homeBias:0.05, reliability:0.75 },

  "Ekstraklasa": { avg:2.85, baseK:1.2, homeBias:0.07, reliability:0.9 },
  "Polish Cup": { avg:2.90, baseK:1.25, homeBias:0.05, reliability:0.75 },

  "HNL": { avg:2.36, baseK:1.2, homeBias:0.07, reliability:0.8 },
  "Croatian Cup": { avg:3.10, baseK:1.25, homeBias:0.05, reliability:0.7 },

  "Latvia Higher League": { avg:2.89, baseK:1.2, homeBias:0.07, reliability:0.85 },
  "Latvian Cup": { avg:4.90, baseK:1.3, homeBias:0.05, reliability:0.7 },

  "Meistriliiga": { avg:3.22, baseK:1.25, homeBias:0.07, reliability:0.85 },
  "Estonian Cup": { avg:4.50, baseK:1.3, homeBias:0.05, reliability:0.7 },

  "Allsvenskan": { avg:2.83, baseK:1.2, homeBias:0.07, reliability:0.9 },
  "Svenska Cupen": { avg:3.10, baseK:1.25, homeBias:0.05, reliability:0.75 },

  "Eliteserien": { avg:2.83, baseK:1.2, homeBias:0.07, reliability:0.9 },
  "Norwegian Cup": { avg:3.60, baseK:1.25, homeBias:0.05, reliability:0.75 },

  "Superliga": { avg:3.27, baseK:1.25, homeBias:0.08, reliability:0.9 },
  "1st Division": { avg:2.81, baseK:1.2, homeBias:0.07, reliability:0.85 },
  "Danish Cup": { avg:4.00, baseK:1.3, homeBias:0.05, reliability:0.7 },

  "Veikkausliiga": { avg:2.93, baseK:1.2, homeBias:0.07, reliability:0.9 },
  "Ykkösliiga": { avg:3.02, baseK:1.25, homeBias:0.07, reliability:0.85 },
  "Ykkönen": { avg:3.51, baseK:1.25, homeBias:0.07, reliability:0.8 },
  "Suomen Cup": { avg:4.00, baseK:1.3, homeBias:0.05, reliability:0.7 },

  "Úrvalsdeild": { avg:3.62, baseK:1.3, homeBias:0.08, reliability:0.8 },
  "Icelandic Cup": { avg:5.00, baseK:1.35, homeBias:0.05, reliability:0.7 },

  "Premier Division": { avg:2.26, baseK:1.2, homeBias:0.07, reliability:0.8 },
  "FAI Cup": { avg:3.00, baseK:1.25, homeBias:0.05, reliability:0.75 },

  "UEFA Champions League": { avg:3.10, baseK:1.25, homeBias:0.07, reliability:0.9 },
  "UEFA Europa League": { avg:2.85, baseK:1.2, homeBias:0.07, reliability:0.9 },
  "UEFA Conference League": { avg:2.71, baseK:1.2, homeBias:0.07, reliability:0.85 },

  "World Cup": { avg:2.70, baseK:1.2, homeBias:0.07, reliability:0.85 }
};

document.getElementById("leagueSelect").addEventListener("change", function(){
  const sel = this.value;
  const meta = leagueMeta[sel];
  document.getElementById("leagueAvg").value = meta ? meta.avg : "";
});
};
// ================== PERHITUNGAN (Lambda, Distribusi, HDP) ==================
function calculateLambda(homeGF, homeGA, awayGF, awayGA, meta, h2hAdj=0) {
  const leagueFactor = meta.avg / 2.5;
  const homeAdv = 1 + meta.homeBias;
  const relAdj = 0.5 + meta.reliability * 0.5;

  let lambdaHome = ((homeGF*0.6 + awayGA*0.4)) * leagueFactor * homeAdv * relAdj;
  let lambdaAway = ((awayGF*0.6 + homeGA*0.4)) * leagueFactor * relAdj;

  if (h2hAdj !== 0) {
    lambdaHome += h2hAdj > 0 ? h2hAdj*0.1 : 0;
    lambdaAway += h2hAdj < 0 ? Math.abs(h2hAdj)*0.1 : 0;
  }
  return { lambdaHome, lambdaAway };
}

// ================== Distribusi Dasar ==================
function factorial(n){ return n? n*factorial(n-1):1; }
function poissonPMF(k, lambda){ return Math.pow(lambda,k)*Math.exp(-lambda)/factorial(k); }

// ================== HDP Probabilitas ==================
function hdpProbability(marginMean, sigma, line) {
  function cdf(x) { return 0.5 * (1 + erf(x / Math.sqrt(2))); }
  function erf(x) {
    let sign = (x>=0)?1:-1; x=Math.abs(x);
    let a1=0.254829592, a2=-0.284496736, a3=1.421413741,
        a4=-1.453152027, a5=1.061405429, p=0.3275911;
    let t=1/(1+p*x);
    let y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-x*x);
    return sign*y;
  }
  let zHome = (marginMean - line) / sigma;
  let pHome = cdf(zHome);
  return {home: pHome, away: 1 - pHome};
}

// ================== Value Bet Threshold ==================
function getValueThresh(meta) {
  if (meta.avg > 3.0) return 0.08;  // Liga produktif → butuh selisih lebih besar
  if (meta.avg < 2.5) return 0.03;  // Liga ketat → selisih kecil sudah cukup
  return 0.05;                       // Moderat default
}

// ================== Deteksi Odds Trap ==================
function detectOddsTrap(prob, odds) {
  if (!odds || odds <= 1.01) return null;
  const implied = 1 / odds;
  const diff = prob - implied;
  if (Math.abs(diff) > 0.15) { 
    return diff > 0 ? "🔥 Potensi Value (Trap Risiko)" : "⚠️ Trap Market";
  }
  return null;
  }
  // ================== ANALISIS & OUTPUT ==================
function computeProbabilities(lambdaHome, lambdaAway) {
  let maxGoals = 6;
  let over=0, under=0, totalProb=0;
  let homeWin=0, draw=0, awayWin=0;
  let expectedMargin=0, variance=0;

  for (let i=0;i<=maxGoals;i++){
    for (let j=0;j<=maxGoals;j++){
      let p = poissonPMF(i, lambdaHome) * poissonPMF(j, lambdaAway);
      totalProb+=p;
      expectedMargin+=(i-j)*p;
      variance+=Math.pow(i-j,2)*p;

      if (i>j) homeWin+=p; 
      else if (i===j) draw+=p; 
      else awayWin+=p;

      if (i+j>2.5) over+=p; else under+=p;
    }
  }
  return {
    over: over/totalProb,
    under: under/totalProb,
    homeWin: homeWin/totalProb,
    draw: draw/totalProb,
    awayWin: awayWin/totalProb,
    margin: expectedMargin/totalProb,
    sigma: Math.sqrt(variance/totalProb - Math.pow(expectedMargin/totalProb,2))
  };
}

function analyze() {
  const league = document.getElementById('leagueSelect').value;
  const meta = leagueMeta[league];

  // input statistik
  const homeGF = parseFloat(document.getElementById('homeGF').value);
  const homeGA = parseFloat(document.getElementById('homeGA').value);
  const awayGF = parseFloat(document.getElementById('awayGF').value);
  const awayGA = parseFloat(document.getElementById('awayGA').value);

  // input odds
  const oddsOver = parseFloat(document.getElementById('oddsOver').value);
  const oddsUnder = parseFloat(document.getElementById('oddsUnder').value);
  const oddsHome = parseFloat(document.getElementById('oddsHome').value);
  const oddsDraw = parseFloat(document.getElementById('oddsDraw').value);
  const oddsAway = parseFloat(document.getElementById('oddsAway').value);
  const hdpLine = parseFloat(document.getElementById('hdpLine').value);
  const oddsHdpHome = parseFloat(document.getElementById('oddsHdpHome').value);
  const oddsHdpAway = parseFloat(document.getElementById('oddsHdpAway').value);

  // hitung lambda
  const {lambdaHome, lambdaAway} = calculateLambda(homeGF, homeGA, awayGF, awayGA, meta);
  const probs = computeProbabilities(lambdaHome, lambdaAway);

  // probabilitas HDP
  const hdpProbs = hdpProbability(probs.margin, probs.sigma, hdpLine);

  // threshold value bet
  const valueThresh = getValueThresh(meta);

  // odds trap check
  let trapOver = detectOddsTrap(probs.over, oddsOver);
  let trapUnder = detectOddsTrap(probs.under, oddsUnder);
  let trapHome = detectOddsTrap(probs.homeWin, oddsHome);
  let trapDraw = detectOddsTrap(probs.draw, oddsDraw);
  let trapAway = detectOddsTrap(probs.awayWin, oddsAway);
  let trapHdpHome = detectOddsTrap(hdpProbs.home, oddsHdpHome);
  let trapHdpAway = detectOddsTrap(hdpProbs.away, oddsHdpAway);

  // hasil analisis
  let html = `<h3>📈 Hasil Analisis (${league})</h3>`;
  html += `<p>Lambda Home: ${lambdaHome.toFixed(2)} | Lambda Away: ${lambdaAway.toFixed(2)}</p>`;
  html += `<p>Probabilitas Over 2.5: ${(probs.over*100).toFixed(1)}% | Under 2.5: ${(probs.under*100).toFixed(1)}%</p>`;
  html += `<p>Probabilitas 1X2 → Home: ${(probs.homeWin*100).toFixed(1)}% | Draw: ${(probs.draw*100).toFixed(1)}% | Away: ${(probs.awayWin*100).toFixed(1)}%</p>`;
  html += `<p>HDP (${hdpLine}) → Home: ${(hdpProbs.home*100).toFixed(1)}% | Away: ${(hdpProbs.away*100).toFixed(1)}%</p>`;

  // value bet cek
  function checkValue(prob, odds, label) {
    if (!odds || odds<=1.01) return "";
    const implied = 1/odds;
    if (prob - implied > valueThresh) {
      return `<p>💰 Value Bet terdeteksi di ${label} (Prob: ${(prob*100).toFixed(1)}% | Odds: ${odds})</p>`;
    }
    return "";
  }
  html += checkValue(probs.over, oddsOver, "Over 2.5");
  html += checkValue(probs.under, oddsUnder, "Under 2.5");
  html += checkValue(probs.homeWin, oddsHome, "Home Win");
  html += checkValue(probs.draw, oddsDraw, "Draw");
  html += checkValue(probs.awayWin, oddsAway, "Away Win");
  html += checkValue(hdpProbs.home, oddsHdpHome, "HDP Home");
  html += checkValue(hdpProbs.away, oddsHdpAway, "HDP Away");

  // odds trap warning
  if (trapOver) html += `<p>🚨 Over Trap: ${trapOver}</p>`;
  if (trapUnder) html += `<p>🚨 Under Trap: ${trapUnder}</p>`;
  if (trapHome) html += `<p>🚨 Home Trap: ${trapHome}</p>`;
  if (trapDraw) html += `<p>🚨 Draw Trap: ${trapDraw}</p>`;
  if (trapAway) html += `<p>🚨 Away Trap: ${trapAway}</p>`;
  if (trapHdpHome) html += `<p>🚨 HDP Home Trap: ${trapHdpHome}</p>`;
  if (trapHdpAway) html += `<p>🚨 HDP Away Trap: ${trapHdpAway}</p>`;

  document.getElementById("result").innerHTML = html;
  }
  </script>
</body>
</html>
