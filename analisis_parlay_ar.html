<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Prediksi Over/Under Ultra Pro</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
    h2 { color: #222; }
    .card { background: #fff; padding: 20px; margin: 15px 0; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.1); }
    label { display: block; margin: 10px 0 5px; font-weight: bold; }
    input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; }
    button { margin-top: 15px; padding: 10px; border: none; border-radius: 8px; background: #007bff; color: white; font-weight: bold; cursor: pointer; }
    button:hover { background: #0056b3; }
    .result { margin-top: 20px; padding: 15px; border-radius: 8px; font-size: 18px; font-weight: bold; }
    .over { background: #d4edda; color: #155724; }
    .under { background: #f8d7da; color: #721c24; }
    .bar { height: 20px; border-radius: 10px; overflow: hidden; margin-top: 10px; background: #eee; }
    .bar-fill { height: 100%; text-align: center; font-size: 12px; font-weight: bold; color: #fff; line-height: 20px; }
  </style>
</head>
<body>
  <h2>Prediksi Over/Under Ultra Pro (xG + Poisson + Odds)</h2>
  <div class="card">
    <label>xG Attack Home</label>
    <input type="number" id="xgHome" step="0.1" placeholder="misal 1.8">

    <label>xG Attack Away</label>
    <input type="number" id="xgAway" step="0.1" placeholder="misal 1.4">

    <label>xG Concede Home</label>
    <input type="number" id="xgHomeConcede" step="0.1" placeholder="misal 1.2">

    <label>xG Concede Away</label>
    <input type="number" id="xgAwayConcede" step="0.1" placeholder="misal 1.6">

    <label>Odds Over</label>
    <input type="number" id="oddsOver" step="0.01" placeholder="1.85">

    <label>Odds Under</label>
    <input type="number" id="oddsUnder" step="0.01" placeholder="1.95">

    <label>Line Over/Under</label>
    <input type="number" id="line" step="0.5" placeholder="2.5">

    <button onclick="prediksiOU()">Prediksi</button>
  </div>

  <div id="hasil" class="result"></div>
  <div class="bar"><div id="barFill" class="bar-fill"></div></div>
  <canvas id="chartGol" width="400" height="200"></canvas>
  <div id="skorTerdekat"></div>

  <script>
    function factorial(n){ return n===0?1:Array.from({length:n},(_,i)=>i+1).reduce((a,b)=>a*b,1); }
    function poisson(lambda,k){ return (Math.pow(lambda,k)*Math.exp(-lambda))/factorial(k); }

    function prediksiOU(){
      let xgHome=parseFloat(document.getElementById("xgHome").value)||0;
      let xgAway=parseFloat(document.getElementById("xgAway").value)||0;
      let xgHomeConcede=parseFloat(document.getElementById("xgHomeConcede").value)||0;
      let xgAwayConcede=parseFloat(document.getElementById("xgAwayConcede").value)||0;
      let oddsOver=parseFloat(document.getElementById("oddsOver").value)||2.0;
      let oddsUnder=parseFloat(document.getElementById("oddsUnder").value)||2.0;
      let line=parseFloat(document.getElementById("line").value)||2.5;

      // expected goals tiap tim
      let expHome=(xgHome+xgAwayConcede)/2;
      let expAway=(xgAway+xgHomeConcede)/2;

      // distribusi skor sampai 5-5
      let skorProb={};
      for(let h=0;h<=5;h++){
        for(let a=0;a<=5;a++){
          let p=poisson(expHome,h)*poisson(expAway,a);
          skorProb[`${h}-${a}`]=p;
        }
      }

      // total gol distribusi
      let distribusi=Array(8).fill(0); // 0-6,7+
      Object.entries(skorProb).forEach(([skor,p])=>{
        let [h,a]=skor.split("-").map(Number);
        let total=h+a;
        if(total<=6) distribusi[total]+=p;
        else distribusi[7]+=p;
      });

      // hitung prob Over/Under line
      let probOver=distribusi.slice(Math.ceil(line+0.01)).reduce((a,b)=>a+b,0);
      let probUnder=1-probOver;

      // implied prob dari odds
      let probMarketOver=(1/oddsOver)/((1/oddsOver)+(1/oddsUnder));

      // gabungan model + pasar
      let finalOver=(probOver*0.6+probMarketOver*0.4);
      let finalUnder=1-finalOver;

      let hasilDiv=document.getElementById("hasil");
      let barFill=document.getElementById("barFill");

      if(finalOver>finalUnder){
        hasilDiv.innerHTML=`Prediksi: OVER 🔥 (${(finalOver*100).toFixed(1)}% confidence) | ExpG: ${(expHome+expAway).toFixed(2)}`;
        hasilDiv.className="result over";
        barFill.style.width=(finalOver*100).toFixed(1)+"%";
        barFill.style.background="#28a745";
        barFill.innerHTML=(finalOver*100).toFixed(1)+"% OVER";
      }else{
        hasilDiv.innerHTML=`Prediksi: UNDER ❄️ (${(finalUnder*100).toFixed(1)}% confidence) | ExpG: ${(expHome+expAway).toFixed(2)}`;
        hasilDiv.className="result under";
        barFill.style.width=(finalUnder*100).toFixed(1)+"%";
        barFill.style.background="#dc3545";
        barFill.innerHTML=(finalUnder*100).toFixed(1)+"% UNDER";
      }

      // Skor paling mungkin
      let skorTerbaik=Object.entries(skorProb).sort((a,b)=>b[1]-a[1])[0];
      document.getElementById("skorTerdekat").innerHTML=`Skor paling mungkin: ${skorTerbaik[0]} (Prob: ${(skorTerbaik[1]*100).toFixed(1)}%)`;

      // Chart distribusi total gol
      let ctx=document.getElementById("chartGol").getContext("2d");
      new Chart(ctx,{
        type:'bar',
        data:{
          labels:["0","1","2","3","4","5","6","7+"],
          datasets:[{
            label:"Probabilitas Total Gol",
            data:distribusi.map(x=>(x*100).toFixed(2)),
            backgroundColor:"#007bff"
          }]
        },
        options:{
          responsive:true,
          plugins:{ legend:{ display:false }},
          scales:{ y:{ beginAtZero:true, ticks:{ callback:v=>v+"%" }}}
        }
      });
    }
  </script>
</body>
</html>